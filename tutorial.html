<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Getting Started
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A functional web application DSL for ASP.NET Web API">
    <meta name="author" content="Ryan Riley">

    <script src="http://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="http://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="/content/style.css" />
    <script type="text/javascript" src="/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/frank-fs/frank">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/index.html">Frank</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1>Getting Started</h1>

<p>In this tutorial, we'll explore the basics of building and hosting Web APIs with Frank.</p>

<h3>Define an Application</h3>

<p>One may define a web application interface using a large variety of signatures.
Indeed, if you search the web, you're likely to find a large number of approaches.
When starting with Frank, I wanted to try to find a way to define an HTTP application
using pure functions and function composition. The closest I found was the following:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">HttpApplication</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">HttpRequestMessage</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">Async</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">HttpResponseMessage</span><span class="o">&gt;</span>
    
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="i">orElse</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="i">left</span> <span onmouseout="hideTip(event, 'fs7', 7)" onmouseover="showTip(event, 'fs7', 7)" class="i">right</span> <span class="o">=</span> <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs8', 8)" onmouseover="showTip(event, 'fs8', 8)" class="i">request</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs9', 9)" onmouseover="showTip(event, 'fs9', 9)" class="i">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs10', 10)" onmouseover="showTip(event, 'fs10', 10)" class="i">orElse</span> (<span onmouseout="hideTip(event, 'fs6', 11)" onmouseover="showTip(event, 'fs6', 11)" class="i">left</span> <span onmouseout="hideTip(event, 'fs8', 12)" onmouseover="showTip(event, 'fs8', 12)" class="i">request</span>) (<span onmouseout="hideTip(event, 'fs7', 13)" onmouseover="showTip(event, 'fs7', 13)" class="i">right</span> <span onmouseout="hideTip(event, 'fs8', 14)" onmouseover="showTip(event, 'fs8', 14)" class="i">request</span>)
<span class="k">let</span> <span class="k">inline</span> (<span class="o">&lt;|&gt;</span>) <span onmouseout="hideTip(event, 'fs6', 15)" onmouseover="showTip(event, 'fs6', 15)" class="i">left</span> <span onmouseout="hideTip(event, 'fs7', 16)" onmouseover="showTip(event, 'fs7', 16)" class="i">right</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs5', 17)" onmouseover="showTip(event, 'fs5', 17)" class="i">orElse</span> <span onmouseout="hideTip(event, 'fs6', 18)" onmouseover="showTip(event, 'fs6', 18)" class="i">left</span> <span onmouseout="hideTip(event, 'fs7', 19)" onmouseover="showTip(event, 'fs7', 19)" class="i">right</span></pre>
</td>
</tr>
</table>

<p>The last of these was a means for merging multiple applications together into a single
application. This allowed for a nice symmetry and elegance in that everything you composed
would always have the same signature. Additional functions would allow you to map
applications to specific methods or uri patterns.</p>

<p>A "Hello, world!" application using these signatures would look like the following:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 20)" onmouseover="showTip(event, 'fs11', 20)" class="i">helloWorld</span> <span onmouseout="hideTip(event, 'fs12', 21)" onmouseover="showTip(event, 'fs12', 21)" class="i">request</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs13', 22)" onmouseover="showTip(event, 'fs13', 22)" class="i">OK</span> <span onmouseout="hideTip(event, 'fs14', 23)" onmouseover="showTip(event, 'fs14', 23)" class="i">ignore</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs15', 24)" onmouseover="showTip(event, 'fs15', 24)" class="i">Str</span> <span class="s">&quot;</span><span class="s">Hello</span><span class="s">,</span><span class="s"> </span><span class="s">world</span><span class="s">!</span><span class="s">&quot;</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs16', 25)" onmouseover="showTip(event, 'fs16', 25)" class="i">async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 26)" onmouseover="showTip(event, 'fs17', 26)" class="i">Return</span></pre>
</td>
</tr>
</table>

<p>A simple echo handler that returns the same input as it received might look like the following:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs18', 27)" onmouseover="showTip(event, 'fs18', 27)" class="i">echo</span> (<span onmouseout="hideTip(event, 'fs19', 28)" onmouseover="showTip(event, 'fs19', 28)" class="i">request</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs2', 29)" onmouseover="showTip(event, 'fs2', 29)" class="i">HttpRequestMessage</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs16', 30)" onmouseover="showTip(event, 'fs16', 30)" class="i">async</span> {
    <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs20', 31)" onmouseover="showTip(event, 'fs20', 31)" class="i">content</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 32)" onmouseover="showTip(event, 'fs3', 32)" class="i">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs21', 33)" onmouseover="showTip(event, 'fs21', 33)" class="i">AwaitTask</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs19', 34)" onmouseover="showTip(event, 'fs19', 34)" class="i">request</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs22', 35)" onmouseover="showTip(event, 'fs22', 35)" class="i">Content</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 36)" onmouseover="showTip(event, 'fs23', 36)" class="i">ReadAsStringAsync</span>()
    <span class="k">return</span> <span onmouseout="hideTip(event, 'fs24', 37)" onmouseover="showTip(event, 'fs24', 37)" class="i">respond</span> <span onmouseout="hideTip(event, 'fs25', 38)" onmouseover="showTip(event, 'fs25', 38)" class="i">HttpStatusCode</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 39)" onmouseover="showTip(event, 'fs26', 39)" class="i">OK</span>
           <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs27', 40)" onmouseover="showTip(event, 'fs27', 40)" class="i">``Content-Type``</span> <span class="s">&quot;</span><span class="s">text</span><span class="s">/</span><span class="s">plain</span><span class="s">&quot;</span>
           <span class="o">&lt;|</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs28', 41)" onmouseover="showTip(event, 'fs28', 41)" class="i">StringContent</span>(<span onmouseout="hideTip(event, 'fs20', 42)" onmouseover="showTip(event, 'fs20', 42)" class="i">content</span>)
}</pre>
</td>
</tr>
</table>

<p>or just:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs29', 43)" onmouseover="showTip(event, 'fs29', 43)" class="i">echo</span> (<span onmouseout="hideTip(event, 'fs19', 44)" onmouseover="showTip(event, 'fs19', 44)" class="i">request</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs2', 45)" onmouseover="showTip(event, 'fs2', 45)" class="i">HttpRequestMessage</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs13', 46)" onmouseover="showTip(event, 'fs13', 46)" class="i">OK</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs27', 47)" onmouseover="showTip(event, 'fs27', 47)" class="i">``Content-Type``</span> <span class="s">&quot;</span><span class="s">text</span><span class="s">/</span><span class="s">plain</span><span class="s">&quot;</span>
       <span class="o">&lt;|</span> (<span onmouseout="hideTip(event, 'fs3', 48)" onmouseover="showTip(event, 'fs3', 48)" class="i">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs21', 49)" onmouseover="showTip(event, 'fs21', 49)" class="i">AwaitTask</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs19', 50)" onmouseover="showTip(event, 'fs19', 50)" class="i">request</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs22', 51)" onmouseover="showTip(event, 'fs22', 51)" class="i">Content</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 52)" onmouseover="showTip(event, 'fs23', 52)" class="i">ReadAsStringAsync</span>())</pre>
</td>
</tr>
</table>

<p>If you want to provide content negotiation, use:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs30', 53)" onmouseover="showTip(event, 'fs30', 53)" class="i">echo</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs31', 54)" onmouseover="showTip(event, 'fs31', 54)" class="i">runConneg</span> <span class="i">formatters</span> <span class="o">&lt;|</span> <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs19', 55)" onmouseover="showTip(event, 'fs19', 55)" class="i">request</span> <span class="k">-&gt;</span>
    <span onmouseout="hideTip(event, 'fs3', 56)" onmouseover="showTip(event, 'fs3', 56)" class="i">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs21', 57)" onmouseover="showTip(event, 'fs21', 57)" class="i">AwaitTask</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs19', 58)" onmouseover="showTip(event, 'fs19', 58)" class="i">request</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs22', 59)" onmouseover="showTip(event, 'fs22', 59)" class="i">Content</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 60)" onmouseover="showTip(event, 'fs23', 60)" class="i">ReadAsStringAsync</span>()</pre>
</td>
</tr>
</table>

<h3>Define an HTTP Resource</h3>

<p>Alas, this approach works only so well. HTTP is a rich communication specification.
The simplicity and elegance of a purely functional approach quickly loses the ability
to communicate back options to the client. For instance, given the above, how do you
return a meaningful <code>405 Method Not Allowed</code> response? The HTTP specification requires
that you list the allowed methods, but if you merge all the logic for selecting an
application into the functions, there is no easy way to recall all the allowed methods,
short of trying them all. You could require that the developer add the list of used
methods, but that, too, misses the point that the application should be collecting this
and helping the developer by taking care of all of the nuts and bolts items.</p>

<p>The next approach I tried involved using a tuple of a list of allowed HTTP methods and
the application handler, which used the merged function approach described above for
actually executing the application. However, once again, there are limitations. This
structure accurately represents a resource, but it does not allow for multiple resources
to coexist side-by-side. Another tuple of uri pattern matching expressions could wrap
a list of these method * handler tuples, but at this point I realized I would be better
served by using real types and added an <code>HttpResource</code> type to ease the type burden.</p>

<p>HTTP resources expose an resource handler function at a given uri.
In the common MVC-style frameworks, this would roughly correspond
to a <code>Controller</code>. Resources should represent a single entity type,
and it is important to note that a <code>Foo</code> is not the same entity
type as a <code>Foo list</code>, which is where the typical MVC approach goes wrong.</p>

<p>The <code>405 Method Not Allowed</code> function allows a resource to correctly respond to messages.
Therefore, we extend the <code>HttpResource</code> with an <code>Invoke</code> method.
Also note that the methods will always be looked up using the latest set. This could
probably be memoized so as to save a bit of time, but it allows us to ensure that all
available methods are reported.</p>

<h3>Compose Applications and Resources into Applications</h3>

<p>A compositional approach to type mapping and handler design.
Here, the actual function shows clearly that we are really using
the <code>id</code> function to return the very same result.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs32', 61)" onmouseover="showTip(event, 'fs32', 61)" class="i">echo2Transform</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs33', 62)" onmouseover="showTip(event, 'fs33', 62)" class="i">id</span></pre>
</td>
</tr>
</table>

<p>The <code>echo2ReadRequest</code> maps the incoming request to a value that can be used
within the actual computation, or <code>echo2Transform</code> in this example.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs34', 63)" onmouseover="showTip(event, 'fs34', 63)" class="i">echo2ReadRequest</span> (<span onmouseout="hideTip(event, 'fs19', 64)" onmouseover="showTip(event, 'fs19', 64)" class="i">request</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs2', 65)" onmouseover="showTip(event, 'fs2', 65)" class="i">HttpRequestMessage</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs3', 66)" onmouseover="showTip(event, 'fs3', 66)" class="i">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs21', 67)" onmouseover="showTip(event, 'fs21', 67)" class="i">AwaitTask</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs19', 68)" onmouseover="showTip(event, 'fs19', 68)" class="i">request</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs22', 69)" onmouseover="showTip(event, 'fs22', 69)" class="i">Content</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 70)" onmouseover="showTip(event, 'fs23', 70)" class="i">ReadAsStringAsync</span>()</pre>
</td>
</tr>
</table>

<p>The <code>echo2Respond</code> maps the outgoing message body to an HTTP response.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs35', 71)" onmouseover="showTip(event, 'fs35', 71)" class="i">echo2Respond</span> <span onmouseout="hideTip(event, 'fs36', 72)" onmouseover="showTip(event, 'fs36', 72)" class="i">body</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs24', 73)" onmouseover="showTip(event, 'fs24', 73)" class="i">respond</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs27', 74)" onmouseover="showTip(event, 'fs27', 74)" class="i">``Content-Type``</span> <span class="s">&quot;</span><span class="s">text</span><span class="s">/</span><span class="s">plain</span><span class="s">&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs36', 75)" onmouseover="showTip(event, 'fs36', 75)" class="i">body</span></pre>
</td>
</tr>
</table>

<p>This <code>echo2</code> is the same in principle as <code>echo</code> above, except that the
logic for the message transform deals only with the concrete types
about which it cares and isn't bothered by the transformations.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs37', 76)" onmouseover="showTip(event, 'fs37', 76)" class="i">echo2</span> <span onmouseout="hideTip(event, 'fs19', 77)" onmouseover="showTip(event, 'fs19', 77)" class="i">request</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs16', 78)" onmouseover="showTip(event, 'fs16', 78)" class="i">async</span> {
    <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs20', 79)" onmouseover="showTip(event, 'fs20', 79)" class="i">content</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs34', 80)" onmouseover="showTip(event, 'fs34', 80)" class="i">echo2ReadRequest</span> <span onmouseout="hideTip(event, 'fs19', 81)" onmouseover="showTip(event, 'fs19', 81)" class="i">request</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs38', 82)" onmouseover="showTip(event, 'fs38', 82)" class="i">body</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs32', 83)" onmouseover="showTip(event, 'fs32', 83)" class="i">echo2Transform</span> <span onmouseout="hideTip(event, 'fs20', 84)" onmouseover="showTip(event, 'fs20', 84)" class="i">content</span>
    <span class="k">return</span> <span onmouseout="hideTip(event, 'fs35', 85)" onmouseover="showTip(event, 'fs35', 85)" class="i">echo2Respond</span> <span class="o">&lt;|</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs28', 86)" onmouseover="showTip(event, 'fs28', 86)" class="i">StringContent</span>(<span onmouseout="hideTip(event, 'fs38', 87)" onmouseover="showTip(event, 'fs38', 87)" class="i">body</span>)
}</pre>
</td>
</tr>
</table>

<p>Create a <code>HttpResource</code> instance at the root of the site that responds to <code>POST</code>.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs39', 88)" onmouseover="showTip(event, 'fs39', 88)" class="i">resource</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs40', 89)" onmouseover="showTip(event, 'fs40', 89)" class="i">route</span> <span class="s">&quot;</span><span class="s">/</span><span class="s">&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs41', 90)" onmouseover="showTip(event, 'fs41', 90)" class="i">post</span> <span onmouseout="hideTip(event, 'fs37', 91)" onmouseover="showTip(event, 'fs37', 91)" class="i">echo2</span></pre>
</td>
</tr>
</table>

<p>Other combinators are available to handle other scenarios, such as:</p>

<ol>
<li>Content Negotiation</li>
<li>Building Responses</li>
<li>Combining applications into resources</li>
<li>Combining resources into applications</li>
</ol>

<p>Check the samples for more examples of these combinators.</p>

<h3>Define a Middleware</h3>

<p>Middlewares follow a Russian-doll model for wrapping resource handlers with additional functionality. Frank middlewares take an <code>HttpApplication</code> and return an <code>HttpApplication</code>.
The <code>Frank.Middleware</code> module defines several, simple middlewares, such as the <code>log</code> middleware that intercepts logs incoming requests and the time taken to respond:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs42', 92)" onmouseover="showTip(event, 'fs42', 92)" class="i">log</span> <span onmouseout="hideTip(event, 'fs43', 93)" onmouseover="showTip(event, 'fs43', 93)" class="i">app</span> <span class="o">=</span> <span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs19', 94)" onmouseover="showTip(event, 'fs19', 94)" class="i">request</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs2', 95)" onmouseover="showTip(event, 'fs2', 95)" class="i">HttpRequestMessage</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs16', 96)" onmouseover="showTip(event, 'fs16', 96)" class="i">async</span> {
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs44', 97)" onmouseover="showTip(event, 'fs44', 97)" class="i">sw</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs45', 98)" onmouseover="showTip(event, 'fs45', 98)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs46', 99)" onmouseover="showTip(event, 'fs46', 99)" class="i">Diagnostics</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs47', 100)" onmouseover="showTip(event, 'fs47', 100)" class="i">Stopwatch</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs48', 101)" onmouseover="showTip(event, 'fs48', 101)" class="i">StartNew</span>()
    <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs49', 102)" onmouseover="showTip(event, 'fs49', 102)" class="i">response</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs43', 103)" onmouseover="showTip(event, 'fs43', 103)" class="i">app</span> <span onmouseout="hideTip(event, 'fs19', 104)" onmouseover="showTip(event, 'fs19', 104)" class="i">request</span>
    <span onmouseout="hideTip(event, 'fs50', 105)" onmouseover="showTip(event, 'fs50', 105)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">Received</span><span class="s"> </span><span class="s">a</span><span class="s"> </span><span class="s">%</span><span class="s">A</span><span class="s"> </span><span class="s">request</span><span class="s"> </span><span class="s">from</span><span class="s"> </span><span class="s">%</span><span class="s">A</span><span class="s">.</span><span class="s"> </span><span class="s">Responded</span><span class="s"> </span><span class="s">in</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s"> </span><span class="s">ms</span><span class="s">.</span><span class="s">&quot;</span>
            <span onmouseout="hideTip(event, 'fs19', 106)" onmouseover="showTip(event, 'fs19', 106)" class="i">request</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 107)" onmouseover="showTip(event, 'fs51', 107)" class="i">Method</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs52', 108)" onmouseover="showTip(event, 'fs52', 108)" class="i">Method</span>
            <span onmouseout="hideTip(event, 'fs19', 109)" onmouseover="showTip(event, 'fs19', 109)" class="i">request</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs53', 110)" onmouseover="showTip(event, 'fs53', 110)" class="i">RequestUri</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 111)" onmouseover="showTip(event, 'fs54', 111)" class="i">PathAndQuery</span>
            <span onmouseout="hideTip(event, 'fs44', 112)" onmouseover="showTip(event, 'fs44', 112)" class="i">sw</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs55', 113)" onmouseover="showTip(event, 'fs55', 113)" class="i">ElapsedMilliseconds</span>
    <span onmouseout="hideTip(event, 'fs44', 114)" onmouseover="showTip(event, 'fs44', 114)" class="i">sw</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs56', 115)" onmouseover="showTip(event, 'fs56', 115)" class="i">Reset</span>()
    <span class="k">return</span> <span onmouseout="hideTip(event, 'fs49', 116)" onmouseover="showTip(event, 'fs49', 116)" class="i">response</span>
}</pre>
</td>
</tr>
</table>

<p>The most likely place to insert middlewares is the outer edge of your application. However, since middlewares are themselves just <code>HttpApplication</code>s, you can compose them into a Frank application at any level. Want to support logging only on one troublesome resource? No problem. Expose the resource as an application, wrap it in the log middleware, and insert it into the larger application as you did before.</p>

<h2>Hosting</h2>

<p>Frank will run on any hosting platform that supports the
<a href="http://asp.net/web-api/">Web API</a> library. To hook up your Frank application,
use the <code>register</code> function, passing in the resources and the instance of <code>HttpConfiguration</code>.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs57', 117)" onmouseover="showTip(event, 'fs57', 117)" class="i">register</span> [<span onmouseout="hideTip(event, 'fs39', 118)" onmouseover="showTip(event, 'fs39', 118)" class="i">resource</span>] <span class="i">config</span></pre>
</td>
</tr>
</table>

<p>This extension adds a default route to your <code>HttpConfiguration</code> instance and
adds a <code>DelegatingHandler</code> instance to the route's <code>HttpConfiguration.MessageHandlers</code> collection.</p>

<div class="tip" id="fs1">type HttpApplication = HttpRequestMessage -&gt; Async&lt;HttpResponseMessage&gt;<br /><br />Full name: Tutorial.HttpApplication</div>
<div class="tip" id="fs2">Multiple items<br />type HttpRequestMessage =<br />&#160;&#160;new : unit -&gt; HttpRequestMessage + 2 overloads<br />&#160;&#160;member Content : HttpContent with get, set<br />&#160;&#160;member Dispose : unit -&gt; unit<br />&#160;&#160;member Headers : HttpRequestHeaders<br />&#160;&#160;member Method : HttpMethod with get, set<br />&#160;&#160;member Properties : IDictionary&lt;string, obj&gt;<br />&#160;&#160;member RequestUri : Uri with get, set<br />&#160;&#160;member ToString : unit -&gt; string<br />&#160;&#160;member Version : Version with get, set<br /><br />Full name: System.Net.Http.HttpRequestMessage<br /><br />--------------------<br />HttpRequestMessage() : unit<br />HttpRequestMessage(method: HttpMethod, requestUri: Uri) : unit<br />HttpRequestMessage(method: HttpMethod, requestUri: string) : unit</div>
<div class="tip" id="fs3">Multiple items<br />type Async<br />static member AsBeginEnd : computation:(&#39;Arg -&gt; Async&lt;&#39;T&gt;) -&gt; (&#39;Arg * AsyncCallback * obj -&gt; IAsyncResult) * (IAsyncResult -&gt; &#39;T) * (IAsyncResult -&gt; unit)<br />static member AwaitEvent : event:IEvent&lt;&#39;Del,&#39;T&gt; * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt; (requires delegate and &#39;Del :&gt; Delegate)<br />static member AwaitIAsyncResult : iar:IAsyncResult * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member AwaitTask : task:Task&lt;&#39;T&gt; -&gt; Async&lt;&#39;T&gt;<br />static member AwaitWaitHandle : waitHandle:WaitHandle * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member CancelDefaultToken : unit -&gt; unit<br />static member Catch : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;Choice&lt;&#39;T,exn&gt;&gt;<br />static member FromBeginEnd : beginAction:(AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg:&#39;Arg1 * beginAction:(&#39;Arg1 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * beginAction:(&#39;Arg1 * &#39;Arg2 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * arg3:&#39;Arg3 * beginAction:(&#39;Arg1 * &#39;Arg2 * &#39;Arg3 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromContinuations : callback:((&#39;T -&gt; unit) * (exn -&gt; unit) * (OperationCanceledException -&gt; unit) -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member Ignore : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;unit&gt;<br />static member OnCancel : interruption:(unit -&gt; unit) -&gt; Async&lt;IDisposable&gt;<br />static member Parallel : computations:seq&lt;Async&lt;&#39;T&gt;&gt; -&gt; Async&lt;&#39;T []&gt;<br />static member RunSynchronously : computation:Async&lt;&#39;T&gt; * ?timeout:int * ?cancellationToken:CancellationToken -&gt; &#39;T<br />static member Sleep : millisecondsDueTime:int -&gt; Async&lt;unit&gt;<br />static member Start : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions * ?cancellationToken:CancellationToken -&gt; Task&lt;&#39;T&gt;<br />static member StartChild : computation:Async&lt;&#39;T&gt; * ?millisecondsTimeout:int -&gt; Async&lt;Async&lt;&#39;T&gt;&gt;<br />static member StartChildAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions -&gt; Async&lt;Task&lt;&#39;T&gt;&gt;<br />static member StartImmediate : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartWithContinuations : computation:Async&lt;&#39;T&gt; * continuation:(&#39;T -&gt; unit) * exceptionContinuation:(exn -&gt; unit) * cancellationContinuation:(OperationCanceledException -&gt; unit) * ?cancellationToken:CancellationToken -&gt; unit<br />static member SwitchToContext : syncContext:SynchronizationContext -&gt; Async&lt;unit&gt;<br />static member SwitchToNewThread : unit -&gt; Async&lt;unit&gt;<br />static member SwitchToThreadPool : unit -&gt; Async&lt;unit&gt;<br />static member TryCancelled : computation:Async&lt;&#39;T&gt; * compensation:(OperationCanceledException -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member CancellationToken : Async&lt;CancellationToken&gt;<br />static member DefaultCancellationToken : CancellationToken<br /><br />Full name: Microsoft.FSharp.Control.Async<br /><br />--------------------<br />type Async&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Control.Async&lt;_&gt;</div>
<div class="tip" id="fs4">Multiple items<br />type HttpResponseMessage =<br />&#160;&#160;new : unit -&gt; HttpResponseMessage + 1 overload<br />&#160;&#160;member Content : HttpContent with get, set<br />&#160;&#160;member Dispose : unit -&gt; unit<br />&#160;&#160;member EnsureSuccessStatusCode : unit -&gt; HttpResponseMessage<br />&#160;&#160;member Headers : HttpResponseHeaders<br />&#160;&#160;member IsSuccessStatusCode : bool<br />&#160;&#160;member ReasonPhrase : string with get, set<br />&#160;&#160;member RequestMessage : HttpRequestMessage with get, set<br />&#160;&#160;member StatusCode : HttpStatusCode with get, set<br />&#160;&#160;member ToString : unit -&gt; string<br />&#160;&#160;...<br /><br />Full name: System.Net.Http.HttpResponseMessage<br /><br />--------------------<br />HttpResponseMessage() : unit<br />HttpResponseMessage(statusCode: HttpStatusCode) : unit</div>
<div class="tip" id="fs5">val orElse : left:&#39;a -&gt; right:&#39;b -&gt; request:&#39;c -&gt; &#39;d<br /><br />Full name: Tutorial.orElse</div>
<div class="tip" id="fs6">val left : &#39;a</div>
<div class="tip" id="fs7">val right : &#39;b</div>
<div class="tip" id="fs8">val request : &#39;c</div>
<div class="tip" id="fs9">module Option<br /><br />from Microsoft.FSharp.Core</div>
<div class="tip" id="fs10">val orElse : &#39;a list * (&#39;b -&gt; &#39;c option) -&gt; &#39;a list * (&#39;b -&gt; &#39;c option) -&gt; &#39;a list * (&#39;b -&gt; &#39;c option)<br /><br />Full name: System.Web.Http.HttpResource.orElse</div>
<div class="tip" id="fs11">val helloWorld : request:&#39;a -&gt; Async&lt;(#HttpRequestMessage -&gt; HttpResponseMessage)&gt;<br /><br />Full name: Tutorial.helloWorld</div>
<div class="tip" id="fs12">val request : &#39;a</div>
<div class="tip" id="fs13">val OK : headers:(HttpResponseMessage -&gt; unit) -&gt; content:#HttpContent option -&gt; (HttpRequestMessage -&gt; HttpResponseMessage)<br /><br />Full name: Frank.Core.OK</div>
<div class="tip" id="fs14">val ignore : value:&#39;T -&gt; unit<br /><br />Full name: Microsoft.FSharp.Core.Operators.ignore</div>
<div class="tip" id="fs15">val Str : s:string -&gt; HttpContent<br /><br />Full name: Frank.Core.Str</div>
<div class="tip" id="fs16">val async : AsyncBuilder<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.async</div>
<div class="tip" id="fs17">member AsyncBuilder.Return : value:&#39;T -&gt; Async&lt;&#39;T&gt;</div>
<div class="tip" id="fs18">val echo : request:HttpRequestMessage -&gt; Async&lt;(#HttpRequestMessage -&gt; HttpResponseMessage)&gt;<br /><br />Full name: Tutorial.echo</div>
<div class="tip" id="fs19">val request : HttpRequestMessage</div>
<div class="tip" id="fs20">val content : string</div>
<div class="tip" id="fs21">static member Async.AwaitTask : task:Threading.Tasks.Task&lt;&#39;T&gt; -&gt; Async&lt;&#39;T&gt;</div>
<div class="tip" id="fs22">property HttpRequestMessage.Content: HttpContent</div>
<div class="tip" id="fs23">HttpContent.ReadAsStringAsync() : Threading.Tasks.Task&lt;string&gt;</div>
<div class="tip" id="fs24">val respond : statusCode:HttpStatusCode -&gt; headers:(HttpResponseMessage -&gt; unit) -&gt; content:#HttpContent option -&gt; request:HttpRequestMessage -&gt; HttpResponseMessage<br /><br />Full name: Frank.Core.respond</div>
<div class="tip" id="fs25">type HttpStatusCode =<br />&#160;&#160;| Continue = 100<br />&#160;&#160;| SwitchingProtocols = 101<br />&#160;&#160;| OK = 200<br />&#160;&#160;| Created = 201<br />&#160;&#160;| Accepted = 202<br />&#160;&#160;| NonAuthoritativeInformation = 203<br />&#160;&#160;| NoContent = 204<br />&#160;&#160;| ResetContent = 205<br />&#160;&#160;| PartialContent = 206<br />&#160;&#160;| MultipleChoices = 300<br />&#160;&#160;...<br /><br />Full name: System.Net.HttpStatusCode</div>
<div class="tip" id="fs26">field HttpStatusCode.OK = 200</div>
<div class="tip" id="fs27">val ( Content-Type ) : x:string -&gt; response:HttpResponseMessage -&gt; unit<br /><br />Full name: Frank.Core.( Content-Type )</div>
<div class="tip" id="fs28">Multiple items<br />type StringContent =<br />&#160;&#160;inherit ByteArrayContent<br />&#160;&#160;new : content:string -&gt; StringContent + 2 overloads<br /><br />Full name: System.Net.Http.StringContent<br /><br />--------------------<br />StringContent(content: string) : unit<br />StringContent(content: string, encoding: Text.Encoding) : unit<br />StringContent(content: string, encoding: Text.Encoding, mediaType: string) : unit</div>
<div class="tip" id="fs29">val echo : request:HttpRequestMessage -&gt; (HttpRequestMessage -&gt; HttpResponseMessage)<br /><br />Full name: Tutorial.echo</div>
<div class="tip" id="fs30">val echo : (HttpRequestMessage -&gt; Async&lt;HttpResponseMessage&gt;)<br /><br />Full name: Tutorial.echo</div>
<div class="tip" id="fs31">val runConneg : formatters:Collections.Generic.IEnumerable&lt;Formatting.MediaTypeFormatter&gt; -&gt; f:(HttpRequestMessage -&gt; Async&lt;&#39;a&gt;) -&gt; (HttpRequestMessage -&gt; Async&lt;HttpResponseMessage&gt;)<br /><br />Full name: Frank.Core.runConneg</div>
<div class="tip" id="fs32">val echo2Transform : (&#39;a -&gt; &#39;a)<br /><br />Full name: Tutorial.echo2Transform</div>
<div class="tip" id="fs33">val id : x:&#39;T -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.id</div>
<div class="tip" id="fs34">val echo2ReadRequest : request:HttpRequestMessage -&gt; Async&lt;string&gt;<br /><br />Full name: Tutorial.echo2ReadRequest</div>
<div class="tip" id="fs35">val echo2Respond : body:(HttpResponseMessage -&gt; unit) -&gt; (#HttpContent option -&gt; HttpRequestMessage -&gt; HttpResponseMessage)<br /><br />Full name: Tutorial.echo2Respond</div>
<div class="tip" id="fs36">val body : (HttpResponseMessage -&gt; unit)</div>
<div class="tip" id="fs37">val echo2 : request:HttpRequestMessage -&gt; Async&lt;(#HttpContent option -&gt; #HttpRequestMessage -&gt; HttpResponseMessage)&gt;<br /><br />Full name: Tutorial.echo2</div>
<div class="tip" id="fs38">val body : string</div>
<div class="tip" id="fs39">val resource : HttpResource<br /><br />Full name: Tutorial.resource</div>
<div class="tip" id="fs40">val route : uri:string -&gt; seq&lt;HttpMethod&gt; * (HttpRequestMessage -&gt; Async&lt;HttpResponseMessage&gt; option) -&gt; HttpResource<br /><br />Full name: System.Web.Http.HttpResource.route</div>
<div class="tip" id="fs41">val post : handler:(HttpRequestMessage -&gt; &#39;a) -&gt; HttpMethod list * (#HttpRequestMessage -&gt; &#39;a option)<br /><br />Full name: System.Web.Http.HttpResource.post</div>
<div class="tip" id="fs42">val log : app:(HttpRequestMessage -&gt; Async&lt;&#39;a&gt;) -&gt; request:HttpRequestMessage -&gt; Async&lt;&#39;a&gt;<br /><br />Full name: Tutorial.log</div>
<div class="tip" id="fs43">val app : (HttpRequestMessage -&gt; Async&lt;&#39;a&gt;)</div>
<div class="tip" id="fs44">val sw : Diagnostics.Stopwatch</div>
<div class="tip" id="fs45">namespace System</div>
<div class="tip" id="fs46">namespace System.Diagnostics</div>
<div class="tip" id="fs47">Multiple items<br />type Stopwatch =<br />&#160;&#160;new : unit -&gt; Stopwatch<br />&#160;&#160;member Elapsed : TimeSpan<br />&#160;&#160;member ElapsedMilliseconds : int64<br />&#160;&#160;member ElapsedTicks : int64<br />&#160;&#160;member IsRunning : bool<br />&#160;&#160;member Reset : unit -&gt; unit<br />&#160;&#160;member Restart : unit -&gt; unit<br />&#160;&#160;member Start : unit -&gt; unit<br />&#160;&#160;member Stop : unit -&gt; unit<br />&#160;&#160;static val Frequency : int64<br />&#160;&#160;...<br /><br />Full name: System.Diagnostics.Stopwatch<br /><br />--------------------<br />Diagnostics.Stopwatch() : unit</div>
<div class="tip" id="fs48">Diagnostics.Stopwatch.StartNew() : Diagnostics.Stopwatch</div>
<div class="tip" id="fs49">val response : &#39;a</div>
<div class="tip" id="fs50">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs51">property HttpRequestMessage.Method: HttpMethod</div>
<div class="tip" id="fs52">property HttpMethod.Method: string</div>
<div class="tip" id="fs53">property HttpRequestMessage.RequestUri: Uri</div>
<div class="tip" id="fs54">property Uri.PathAndQuery: string</div>
<div class="tip" id="fs55">property Diagnostics.Stopwatch.ElapsedMilliseconds: int64</div>
<div class="tip" id="fs56">Diagnostics.Stopwatch.Reset() : unit</div>
<div class="tip" id="fs57">val register : resources:seq&lt;HttpResource&gt; -&gt; config:HttpConfiguration -&gt; unit<br /><br />Full name: System.Web.Http.HttpResource.register</div>

        </div>
        <div class="span3">
          <img src="img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu">
            <li class="nav-header">Frank</li>
            <li><a href="/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.com/packages/Frank">Get Library via NuGet</a></li>
            <li><a href="http://github.com/frank-fs/frank">Source Code on GitHub</a></li>
            <li><a href="http://github.com/frank-fs/frank/blob/master/LICENSE.txt">License</a></li>
            <li><a href="http://github.com/frank-fs/frank/blob/master/RELEASE_NOTES.md">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="/tutorial.html">Sample tutorial</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/frank-fs/frank"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
</html>
